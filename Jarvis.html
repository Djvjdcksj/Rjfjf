<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvis Voice Assistant</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #121212;
            color: white;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        button {
            background-color: #808080; /* Gray color */
            color: white;
            padding: 15px; /* Equal padding for round shape */
            border: none;
            font-size: 18px;
            cursor: pointer;
            border-radius: 50%; /* Round shape */
            width: 60px; /* Fixed width for circle */
            height: 60px; /* Fixed height for circle */
            margin: 10px;
            transition: all 0.3s ease;
        }
        button:hover {
            background-color: #666666; /* Darker gray on hover */
            transform: scale(1.05);
        }
        button.listening {
            background-color: #ff4444; /* Red when listening */
            animation: pulse 1s infinite;
        }
        .output {
            margin: 20px 0;
            font-size: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .examples {
            color: #888;
            font-size: 16px;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Jarvis Voice Assistant</h1>
        <button id="voiceBtn" onclick="toggleListening()">ðŸŽ¤</button>
        <p class="output" id="output">Waiting for command...</p>
        <p class="examples">Try: "What's the time now", "What's the day", "What's the date", "Set timer you have to go home after 5 minutes", "What is my reminder", "Clear reminders", "Search for funny cat videos", "Who is Elon Musk", "Play song [song name]"</p>
    </div>

    <script>
        let isListening = false;
        let recognition;
        const output = document.getElementById('output');
        const voiceBtn = document.getElementById('voiceBtn');
        let reminders = JSON.parse(localStorage.getItem("reminders")) || [];

        function saveReminders() {
            localStorage.setItem("reminders", JSON.stringify(reminders));
        }

        function checkReminders() {
            const now = new Date().getTime();
            reminders = reminders.filter(reminder => {
                if (reminder.dueTime <= now) {
                    speak(`Reminder: ${reminder.text}`);
                    return false;
                }
                return true;
            });
            saveReminders();
        }
        setInterval(checkReminders, 5000); // Check every 5 seconds

        function toggleListening() {
            if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                alert("Your browser does not support voice recognition. Try using Chrome.");
                return;
            }

            if (!isListening) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = "en-US";
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onstart = () => {
                    isListening = true;
                    voiceBtn.classList.add('listening');
                    voiceBtn.textContent = 'ðŸŽ¤';
                    output.textContent = 'Listening...';
                };

                recognition.onresult = (event) => {
                    const command = event.results[0][0].transcript.toLowerCase();
                    console.log("Recognized command:", command);
                    output.textContent = `You said: ${command}`;
                    handleCommand(command);
                };

                recognition.onerror = (event) => {
                    console.error("Speech Recognition Error:", event.error);
                    output.textContent = `Error: ${event.error}. Try again.`;
                    stopListening();
                };

                recognition.onend = stopListening;
                recognition.start();
            } else {
                stopListening();
            }
        }

        function stopListening() {
            if (recognition) {
                recognition.stop();
            }
            isListening = false;
            voiceBtn.classList.remove('listening');
            voiceBtn.textContent = 'ðŸŽ¤';
        }

        async function handleCommand(command) {
            try {
                if (command.match(/what(?:'s| is) the time/)) {
                    const now = new Date();
                    const hours = now.getHours() % 12 || 12;
                    const minutes = now.getMinutes().toString().padStart(2, '0');
                    const period = now.getHours() >= 12 ? "PM" : "AM";
                    await speak(`The time is ${hours}:${minutes} ${period}`);
                    return;
                }

                if (command.match(/what(?:'s| is) the day/)) {
                    const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
                    const now = new Date();
                    const day = days[now.getDay()];
                    await speak(`Today is ${day}`);
                    return;
                }

                if (command.match(/what(?:'s| is) the date/)) {
                    const now = new Date();
                    const date = now.toLocaleDateString();
                    await speak(`Today's date is ${date}`);
                    return;
                }

                if (command.includes("set timer")) {
                    const match = command.match(/set timer (.+) after (\d+) minutes?/);
                    if (match) {
                        const text = match[1];
                        const minutes = parseInt(match[2]);
                        const dueTime = new Date().getTime() + minutes * 60000;
                        reminders.push({ text, dueTime });
                        saveReminders();
                        await speak(`Timer set: ${text} in ${minutes} minutes`);
                    } else {
                        await speak("Please say 'set timer [text] after [minutes] minutes'");
                    }
                    return;
                }

                if (command.includes("what is my reminder")) {
                    if (reminders.length > 0) {
                        await speak(`Your reminders are: ${reminders.map(r => r.text).join(", ")}`);
                    } else {
                        await speak("No reminders set.");
                    }
                    return;
                }

                if (command.includes("clear reminders")) {
                    reminders = [];
                    saveReminders();
                    await speak("All reminders have been cleared.");
                    return;
                }

                if (command.includes("search for")) {
                    const query = command.replace("search for", "").trim();
                    const searchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`;
                    window.open(searchUrl, "_blank");
                    await speak(`Searching for ${query} on YouTube`);
                    return;
                }

                if (command.includes("who is ")) {
                    const person = command.replace("who is ", "").trim();
                    const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(person)}`);
                    const data = await response.json();
                    await speak(data.extract || "Sorry, no information available");
                    return;
                }

                if (command.includes("play song") || command.includes("sing")) {
                    const song = command.replace("play song", "").replace("sing", "").trim();
                    if (song) {
                        const searchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(song)}`;
                        window.open(searchUrl, "_blank");
                        await speak(`Playing ${song}`);
                    } else {
                        await speak("Please specify a song name.");
                    }
                    return;
                }

                await speak("I didn't understand that.");
            } catch (error) {
                console.error("Command Error:", error);
                await speak("An error occurred.");
            }
            stopListening();
        }

        function speak(text) {
            output.textContent = text;
            return new Promise((resolve) => {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US'; // Ensure English voice
                    utterance.volume = 1.0; // Full volume
                    utterance.rate = 1.0; // Normal speed
                    utterance.pitch = 1.0; // Normal pitch

                    utterance.onend = () => {
                        console.log("Speech finished:", text);
                        resolve();
                    };
                    utterance.onerror = (e) => {
                        console.error("SpeechSynthesis Error:", e.error, e.message);
                        output.textContent = "Error speaking. Check console.";
                        resolve();
                    };
                    // Ensure no pending utterances
                    speechSynthesis.cancel();
                    speechSynthesis.speak(utterance);
                } else {
                    console.error("SpeechSynthesis not supported");
                    output.textContent = "Speech not supported in this browser.";
                    resolve();
                }
            });
        }

        window.onload = () => {
            speak("I am Jarvis, your personal assistant.");
        };
    </script>
</body>
</html>
